function _(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function L(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var w={},k={};Object.defineProperty(k,"__esModule",{value:!0});var l={};Object.defineProperty(l,"__esModule",{value:!0});l.ConstantBackoff=void 0;var m=function(){function n(e){this.reset=function(){},this.backoff=e}return n.prototype.next=function(){return this.backoff},n}();l.ConstantBackoff=m;var d={};Object.defineProperty(d,"__esModule",{value:!0});d.ExponentialBackoff=void 0;var B=function(){function n(e,t){this.initial=e,this.expMax=t,this.expCurrent=1,this.current=this.initial}return n.prototype.next=function(){var e=this.current;return this.expMax>this.expCurrent++&&(this.current=this.current*2),e},n.prototype.reset=function(){this.expCurrent=1,this.current=this.initial},n}();d.ExponentialBackoff=B;var p={};Object.defineProperty(p,"__esModule",{value:!0});p.LinearBackoff=void 0;var P=function(){function n(e,t,r){this.initial=e,this.increment=t,this.maximum=r,this.current=this.initial}return n.prototype.next=function(){var e=this.current,t=this.current+this.increment;return this.maximum===void 0?this.current=t:t<=this.maximum&&(this.current=t),e},n.prototype.reset=function(){this.current=this.initial},n}();p.LinearBackoff=P;var g={};Object.defineProperty(g,"__esModule",{value:!0});var v={};Object.defineProperty(v,"__esModule",{value:!0});v.LRUBuffer=void 0;var O=function(){function n(e){this.writePtr=0,this.wrapped=!1,this.buffer=Array(e)}return n.prototype.len=function(){return this.wrapped?this.buffer.length:this.writePtr},n.prototype.cap=function(){return this.buffer.length},n.prototype.read=function(e){if(e==null||e.length===0||this.buffer.length===0||this.writePtr===0&&!this.wrapped)return 0;for(var t=this.wrapped?this.writePtr:0,r=t-1<0?this.buffer.length-1:t-1,i=0;i<e.length;i++){var o=(t+i)%this.buffer.length;if(e[i]=this.buffer[o],o===r)return i+1}return e.length},n.prototype.write=function(e){if(e==null||e.length===0||this.buffer.length===0)return 0;for(var t=e.length>this.buffer.length?e.length-this.buffer.length:0,r=0;r<e.length-t;r++)this.buffer[this.writePtr]=e[t+r],this.writePtr=(this.writePtr+1)%this.buffer.length,this.writePtr===0&&(this.wrapped=!0);return e.length},n.prototype.forEach=function(e){if(this.writePtr===0&&!this.wrapped)return 0;for(var t=this.wrapped?this.writePtr:0,r=this.wrapped?t-1<0?this.buffer.length-1:t-1:this.writePtr-1,i=this.len();e(this.buffer[t]),t!==r;)t=(t+1)%this.buffer.length;return i},n.prototype.clear=function(){this.writePtr=0,this.wrapped=!1},n}();v.LRUBuffer=O;var b={};Object.defineProperty(b,"__esModule",{value:!0});b.TimeBuffer=void 0;var j=function(){function n(e){this.maxAge=e}return n.prototype.cap=function(){return Number.POSITIVE_INFINITY},n.prototype.len=function(){this.forwardTail();for(var e=this.tail,t=0;e!==void 0;)t++,e=e.n;return t},n.prototype.read=function(e){if(this.forwardTail(),e.length===0)return 0;for(var t=this.tail,r=0;t!==void 0&&(e[r++]=t.e,r!==e.length);)t=t.n;return r},n.prototype.write=function(e){for(var t=0;t<e.length;t++)this.putElement(e[t]);return e.length},n.prototype.forEach=function(e){this.forwardTail();for(var t=this.tail,r=0;t!==void 0;)e(t.e),r++,t=t.n;return r},n.prototype.putElement=function(e){var t={e,t:Date.now(),n:void 0};this.tail===void 0&&(this.tail=t),this.head===void 0?this.head=t:(this.head.n=t,this.head=t)},n.prototype.forwardTail=function(){if(this.tail!==void 0)for(var e=Date.now();e-this.tail.t>this.maxAge&&(this.tail===this.head?(this.tail=void 0,this.head=void 0):this.tail=this.tail.n,this.tail!==void 0););},n.prototype.clear=function(){},n}();b.TimeBuffer=j;var E={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Websocket=n.WebsocketEvents=void 0;var e;(function(r){r.open="open",r.close="close",r.error="error",r.message="message",r.retry="retry"})(e=n.WebsocketEvents||(n.WebsocketEvents={}));var t=function(){function r(i,o,s,u){var a=this;this.eventListeners={open:[],close:[],error:[],message:[],retry:[]},this.closedByUser=!1,this.retries=0,this.handleOpenEvent=function(f){return a.handleEvent(e.open,f)},this.handleCloseEvent=function(f){return a.handleEvent(e.close,f)},this.handleErrorEvent=function(f){return a.handleEvent(e.error,f)},this.handleMessageEvent=function(f){return a.handleEvent(e.message,f)},this.url=i,this.protocols=o,this.buffer=s,this.backoff=u,this.tryConnect()}return Object.defineProperty(r.prototype,"underlyingWebsocket",{get:function(){return this.websocket},enumerable:!1,configurable:!0}),r.prototype.send=function(i){var o;this.closedByUser||(this.websocket===void 0||this.websocket.readyState!==this.websocket.OPEN?(o=this.buffer)===null||o===void 0||o.write([i]):this.websocket.send(i))},r.prototype.close=function(i,o){var s;this.closedByUser=!0,(s=this.websocket)===null||s===void 0||s.close(i,o)},r.prototype.addEventListener=function(i,o,s){var u={listener:o,options:s},a=this.eventListeners[i];a.push(u)},r.prototype.removeEventListener=function(i,o,s){this.eventListeners[i]=this.eventListeners[i].filter(function(u){return u.listener!==o&&(u.options===void 0||u.options!==s)})},r.prototype.dispatchEvent=function(i,o){var s=this,u=this.eventListeners[i],a=[];u.forEach(function(f){f.listener(s,o),f.options!==void 0&&f.options.once&&a.push(f)}),a.forEach(function(f){return s.removeEventListener(i,f.listener,f.options)})},r.prototype.tryConnect=function(){this.websocket!==void 0&&(this.websocket.removeEventListener(e.open,this.handleOpenEvent),this.websocket.removeEventListener(e.close,this.handleCloseEvent),this.websocket.removeEventListener(e.error,this.handleErrorEvent),this.websocket.removeEventListener(e.message,this.handleMessageEvent),this.websocket.close()),this.websocket=new WebSocket(this.url,this.protocols),this.websocket.addEventListener(e.open,this.handleOpenEvent),this.websocket.addEventListener(e.close,this.handleCloseEvent),this.websocket.addEventListener(e.error,this.handleErrorEvent),this.websocket.addEventListener(e.message,this.handleMessageEvent)},r.prototype.handleEvent=function(i,o){var s,u,a;switch(i){case e.close:this.closedByUser||this.reconnect();break;case e.open:this.retries=0,(s=this.backoff)===null||s===void 0||s.reset(),(u=this.buffer)===null||u===void 0||u.forEach(this.send.bind(this)),(a=this.buffer)===null||a===void 0||a.clear();break}this.dispatchEvent(i,o)},r.prototype.reconnect=function(){var i=this;if(this.backoff!==void 0){var o=this.backoff.next();setTimeout(function(){i.dispatchEvent(e.retry,new CustomEvent(e.retry,{detail:{retries:++i.retries,backoff:o}})),i.tryConnect()},o)}},r}();n.Websocket=t})(E);var y={};Object.defineProperty(y,"__esModule",{value:!0});y.WebsocketBuilder=void 0;var h=E,M=function(){function n(e){this.ws=null,this.onOpenListeners=[],this.onCloseListeners=[],this.onErrorListeners=[],this.onMessageListeners=[],this.onRetryListeners=[],this.url=e}return n.prototype.withProtocols=function(e){return this.protocols=e,this},n.prototype.withBackoff=function(e){return this.backoff=e,this},n.prototype.withBuffer=function(e){return this.buffer=e,this},n.prototype.onOpen=function(e,t){return this.onOpenListeners.push({listener:e,options:t}),this},n.prototype.onClose=function(e,t){return this.onCloseListeners.push({listener:e,options:t}),this},n.prototype.onError=function(e,t){return this.onErrorListeners.push({listener:e,options:t}),this},n.prototype.onMessage=function(e,t){return this.onMessageListeners.push({listener:e,options:t}),this},n.prototype.onRetry=function(e,t){return this.onRetryListeners.push({listener:e,options:t}),this},n.prototype.build=function(){var e=this;return this.ws!==null?this.ws:(this.ws=new h.Websocket(this.url,this.protocols,this.buffer,this.backoff),this.onOpenListeners.forEach(function(t){var r;return(r=e.ws)===null||r===void 0?void 0:r.addEventListener(h.WebsocketEvents.open,t.listener,t.options)}),this.onCloseListeners.forEach(function(t){var r;return(r=e.ws)===null||r===void 0?void 0:r.addEventListener(h.WebsocketEvents.close,t.listener,t.options)}),this.onErrorListeners.forEach(function(t){var r;return(r=e.ws)===null||r===void 0?void 0:r.addEventListener(h.WebsocketEvents.error,t.listener,t.options)}),this.onMessageListeners.forEach(function(t){var r;return(r=e.ws)===null||r===void 0?void 0:r.addEventListener(h.WebsocketEvents.message,t.listener,t.options)}),this.onRetryListeners.forEach(function(t){var r;return(r=e.ws)===null||r===void 0?void 0:r.addEventListener(h.WebsocketEvents.retry,t.listener,t.options)}),this.ws)},n}();y.WebsocketBuilder=M;(function(n){var e=c&&c.__createBinding||(Object.create?function(r,i,o,s){s===void 0&&(s=o),Object.defineProperty(r,s,{enumerable:!0,get:function(){return i[o]}})}:function(r,i,o,s){s===void 0&&(s=o),r[s]=i[o]}),t=c&&c.__exportStar||function(r,i){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&e(i,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(k,n),t(l,n),t(d,n),t(p,n),t(g,n),t(v,n),t(b,n),t(E,n),t(y,n)})(w);const C=L(w),W=_({__proto__:null,default:C},[w]);export{W as i};
